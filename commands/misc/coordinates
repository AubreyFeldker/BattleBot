module.exports.run = async (client, message, args, level, Discord) => {
  // Ensure the factionSettings exists in the Enmap
  client.factionSettings.ensure(message.guild.id, client.config.factionSettings);

  const re = new RegExp('^\b[A-J][0-9]?$');
  const filter = post => re.test(post.content);

  const collector = message.channel.createMessageCollector({ filter, time: 30000 });

  collector.on('collect', post => {
	post.delete();
  });

  let values = new Array(100).fill(0);

  collector.on('end', posts => {
	posts.forEach((value) => {
        values[((test.charCodeAt(test) - 65) * 10 + parseInt(test.substring(1,2)))]++;
    })
  });

  let biggestVals = [];
  let biggestNum = 0;

  for(let i = 0; i < values.length; i++) {
      if (values[i] > biggestNum) {
        biggestNum = values[i];
        biggestVals = [i];
      }
      else if (values[i] == biggestNum)
        biggestVals.push(i);
  }

  let chosenVal = biggestVals[Math.trunc(Math.random() * biggestVals.length)];

  message.channel.send(`Voting is over! The space most voted on was ${String.fromCharCode(Math.trunc(chosenVal / 10) + 65)}${chosenVal % 10} with ${biggestNum} votes.`)
};

module.exports.conf = {
  guildOnly: true,
  aliases: [],
  permLevel: 'Mod',
  args: 1,
};

module.exports.help = {
  name: 'battle',
  category: 'factions',
  description: 'Controls faction battle settings through an interactive dialogue',
  usage: 'battle <-start|-end>',
};
